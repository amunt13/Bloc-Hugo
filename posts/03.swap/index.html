<!doctype html><html lang=ca><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Swap | Linux, BSD i altres herbes</title><meta property="og:title" content="Swap | Linux, BSD i altres herbes"><meta name=twitter:title content="Swap | Linux, BSD i altres herbes"><meta itemprop=name content="Swap | Linux, BSD i altres herbes"><meta name=application-name content="Swap | Linux, BSD i altres herbes"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="ca"><meta name=language content="ca"><link rel=alternate hreflang=ca href=https://amunt13.github.io/Bloc-Hugo/posts/03.swap/ title><meta property="og:type" content="article"><meta property="og:article:published_time" content=2025-11-04T07:06:43+0100><meta property="article:published_time" content=2025-11-04T07:06:43+0100><meta property="og:url" content="https://amunt13.github.io/Bloc-Hugo/posts/03.swap/"><meta property="og:article:author" content="amunt13"><meta property="article:author" content="amunt13"><meta name=author content="amunt13"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Swap","author":{"@type":"Person","name":""},"datePublished":"2025-11-04","description":"","wordCount":712,"mainEntityOfPage":"True","dateModified":"2025-11-04","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Linux, BSD i altres herbes"}}</script><meta name=generator content="Hugo 0.152.2"><meta property="og:url" content="https://amunt13.github.io/Bloc-Hugo/posts/03.swap/"><meta property="og:site_name" content="Linux, BSD i altres herbes"><meta property="og:title" content="Swap"><meta property="og:description" content="Això és una reflexió sobre la Swap sorgida com a conseqüència del xifrat que vaig fer d’un ordinador portàtil.
En aquestes circumstàcies has de posar la contrasenya tantes vegades com particions xifris. I això no és còmode. El primer que se t’acudeix és agrupar-ho tot a la partició arrel. És a dir, parteixes d’un esquema /boot, / i swap. /boot no pot anar encriptada a l’arrencada. / és l’objecte de l’encriptació. Swap és el tema què ens ocupa, ja que pot contenir informació sensible."><meta property="og:locale" content="ca"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-04T07:06:43+01:00"><meta property="article:modified_time" content="2025-11-04T07:06:43+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Swap"><meta name=twitter:description content="Això és una reflexió sobre la Swap sorgida com a conseqüència del xifrat que vaig fer d’un ordinador portàtil.
En aquestes circumstàcies has de posar la contrasenya tantes vegades com particions xifris. I això no és còmode. El primer que se t’acudeix és agrupar-ho tot a la partició arrel. És a dir, parteixes d’un esquema /boot, / i swap. /boot no pot anar encriptada a l’arrencada. / és l’objecte de l’encriptació. Swap és el tema què ens ocupa, ja que pot contenir informació sensible."><link rel=canonical href=https://amunt13.github.io/Bloc-Hugo/posts/03.swap/><link href=/Bloc-Hugo/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css rel=stylesheet><link href=/Bloc-Hugo/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/Bloc-Hugo/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/Bloc-Hugo/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/Bloc-Hugo/icons/favicon-16x16.png><link rel=mask-icon href=/Bloc-Hugo/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/Bloc-Hugo/favicon.ico><link rel=manifest href=https://amunt13.github.io/Bloc-Hugo/site.webmanifest><meta name=msapplication-config content="/Bloc-Hugo/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><meta name=color-scheme content="light dark"><link rel=icon type=image/svg+xml href=/Bloc-Hugo/icons/favicon.svg><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin=anonymous crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity="sha512-LQNxIMR5rXv7o+b1l8+N1EZMfhG7iFZ9HhnbJkTp4zjNr5Wvst75AqUeFDxeRUa7l5vEDyUiAip//r+EFLLCyA==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script></head><body data-theme class=notransition><script src=/Bloc-Hugo/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://amunt13.github.io/Bloc-Hugo/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/Bloc-Hugo/>Inici</a></li><li><a class=menu-link href=/Bloc-Hugo/posts/>Bloc</a></li><li><a class=menu-link href=/Bloc-Hugo/about/>Sobre mi</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
<svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Swap</h1><div class=post-meta><time datetime=2025-11-04T07:06:43+01:00 itemprop=datePublished>4 de nov. 2025</time></div></header><details class=toc zgotmplz><summary><b>Índex de continguts</b></summary><nav id=TableOfContents><ul><li><a href=#una-solució-xifrat-automàtic-de-la-swap>Una solució: xifrat automàtic de la swap.</a></li><li><a href=#no-crear-partició-swap>No crear partició swap.</a></li><li><a href=#reflexió-final-sobre-la-swap>Reflexió final sobre la swap:</a></li></ul></nav></details><div class=page-content><p>Això és una reflexió sobre la Swap sorgida com a conseqüència del xifrat que vaig fer d&rsquo;un ordinador portàtil.</p><p>En aquestes circumstàcies has de posar la contrasenya tantes vegades com particions xifris. I això no és còmode. El primer que se t&rsquo;acudeix és agrupar-ho tot a la partició arrel. És a dir, parteixes d&rsquo;un esquema /boot, / i swap. /boot no pot anar encriptada a l&rsquo;arrencada. / és l&rsquo;objecte de l&rsquo;encriptació. Swap és el tema què ens ocupa, ja que pot contenir informació sensible.</p><p>Així que el tema és com evitar de posar la contrasenya dues vegades, per a la partició arrel i per a la swap. He de dir que he trobat dues solucions. Fer un xifrat automàtic de la ram i l&rsquo;altra, eliminar-la.</p><h2 id=una-solució-xifrat-automàtic-de-la-swap>Una solució: xifrat automàtic de la swap.</h2><p>Aquesta solució me la va donar la IA quan estava instal·lant FreeBSD a un portàtil. Es tracta de dir-li al sistema que xifrii la swap a l&rsquo;arrencada amb Geli. Per fer-ho fes el següent:</p><ol><li><p>Desactiva la wap <code>swapoff -a</code>.</p></li><li><p>Encripta la partició swap amb una contrassenya temporal: <code>geli onetime /dev/your-swap-partition</code>. Per identificar la partició pots utilitzar l&rsquo;ordre <code>gpart show</code>.</p></li><li><p>Activa la swap encriptada: <code>swapon /dev/your-swap-partition.eli</code>.</p></li><li><p>Activa el mòdul a l&rsquo;arrencada: Afegeix <code>"geom\_eli\_load="YES"</code> a <code>/boot/loader.conf</code>.</p></li><li><p>Configura <code>/etc/fstab</code>: Canvia la línia correponent a la swap per afegir el sufix <code>eli</code>. Per exemple, <code>/dev/ada0p4.eli</code> en lloc de <code>/dev/ada0p4</code>.</p></li><li><p>Reinicia el sistema. Es crearà automàticament una clau temporal per encriptar la swap a cada inici.</p></li></ol><p>D&rsquo;aquesta manera la swap quedarà encriptada i no necessitaras introduïr cap altra contrassenya. Pots verificar l&rsquo;estat de la swap amb l&rsquo;ordre <code>swapinfo</code>. Si tot és correcte, la sortida tindrà un sufix <code>.eli</code>com per exemple <code>/dev/ada0p4.eli</code>.</p><p>Sembla que a Linux també es pot fer, però amb eines diferents. He llegit que Debian i Ubuntu ho duen incorporat, però jo no he vist com fer-ho.</p><h2 id=no-crear-partició-swap>No crear partició swap.</h2><p>Pel què he llegit això es pot aconseguir de dues maneres, enviant la swap a un fitxer o creant la zram. Ara parlaré de la zram.</p><p>És la solució que aporta Fedora per defecte en la instal·lació de la versió workstation, que és la que vaig provar. Suprimeix la ram perquè n&rsquo;amplia la física existent en base a un procés de compressió. Es pot usar sense swap o també amb ella creant un sistema mixt. És evident que si vols evitar el posar la contrasenya per a la swap, el correcte és eliminar-la.</p><p>És una tecnologia antiga I molt eficient. La zram comprimeix la ram de forma dinàmica a costa de l&rsquo;ús de la CPU. La pèrdua de rendiment per aquest motiu és molt menor que la que provoquen les lectures- escriptures a la swap física. El fet que sigui una eina dinàmica vol dir que realment l’us de la zram s’inicia pràcticament en el mateix moment en el què es faria ús de la swap física. Es a dir, realment l’aplicació de la zram no redueix la ram física disponible, encara que en tingui una part reservada. Quan es necessita la paginació, s’activa la zram i sempre de forma prioritaria davant la possible existència de partició swap.
Es una solució molt bona per evitar la necessitat de tenir swap (sistemes live o evitar xifrar la swap). També és una estratègia de mantenir un bon rendiment del PC en situacions de molta demanda de ram i d’evitar escriptures al disc que danyen les ssd.
Es molt fàcil d’habilitar:</p><p><code>sudo apt install zram-tools</code></p><p><code>echo -e "ALGO=zstd\nPERCENT=60" | sudo tee -a /etc/default/zramswap</code></p><p>(això modifica la configuració per defecte, indicant el tipus de compresió, zstd -la mes eficient-, i percentatge de la ram total disponible per la zram).</p><p><code>sudo service zramswap reload</code></p><p><code>sudo swapon –show</code> (Per veure com esta la swap).</p><h2 id=reflexió-final-sobre-la-swap>Reflexió final sobre la swap:</h2><p>Deixant clar que no estem parlant d&rsquo;ordinadors amb un ús crític i que la memòria ram no és cara, puc fer la següent reflexió:</p><ol><li><p>Si necessites hivernar el PC, crea una partició swap. Les recomanacions van des del mateix tamany de la ram, fins al doble. Per a màquines amb quantitats considerables de ram, les actuals, Fedora recomana un tamany $ x + \sqrt{x} $, essent $ x $ el tamany de la ram física.</p></li><li><p>En cas contrari, evita la partició swap i crea zram,especialment en ordinadors portàtils xifrats.</p></li></ol></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons></div><small class=footer_copyright>© 2025 amunt13.</small></footer><a href=# title id=totop><svg width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://amunt13.github.io/Bloc-Hugo/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>